import { PrismaClient } from '@prisma/client'
import bcryptjs from 'bcryptjs'

const prisma = new PrismaClient()

async function main() {
  console.log('üå± Starting database seed...')

  // Clear existing data
  await prisma.prayerResponse.deleteMany()
  await prisma.prayerRequest.deleteMany()
  await prisma.forumComment.deleteMany()
  await prisma.forumPost.deleteMany()
  await prisma.forum.deleteMany()
  await prisma.groupMember.deleteMany()
  await prisma.group.deleteMany()
  await prisma.notification.deleteMany()
  await prisma.report.deleteMany()
  await prisma.user.deleteMany()

  // Hash passwords
  const hashedPassword = await bcryptjs.hash('demo123', 10)

  // Create users
  const admin = await prisma.user.create({
    data: {
      email: 'admin@comunidadeviva.com',
      name: 'Administrador',
      ministry: 'Lideran√ßa',
      role: 'ADMIN',
      phone: '(11) 99999-0001',
      bio: 'Administrador da plataforma Comunidade Viva'
    }
  })

  const pastor = await prisma.user.create({
    data: {
      email: 'pastor@comunidadeviva.com',
      name: 'Pastor Jo√£o Silva',
      ministry: 'Pastoral',
      role: 'LEADER',
      phone: '(11) 99999-0002',
      bio: 'Pastor respons√°vel pela igreja'
    }
  })

  const members = await Promise.all([
    prisma.user.create({
      data: {
        email: 'maria@email.com',
        name: 'Maria Santos',
        ministry: 'Louvor e Adora√ß√£o',
        role: 'MEMBER',
        phone: '(11) 99999-0003',
        bio: 'Cantora no minist√©rio de louvor'
      }
    }),
    prisma.user.create({
      data: {
        email: 'pedro@email.com',
        name: 'Pedro Oliveira',
        ministry: 'Jovens',
        role: 'MEMBER',
        phone: '(11) 99999-0004',
        bio: 'L√≠der do minist√©rio de jovens'
      }
    }),
    prisma.user.create({
      data: {
        email: 'ana@email.com',
        name: 'Ana Costa',
        ministry: 'Infantil',
        role: 'MEMBER',
        phone: '(11) 99999-0005',
        bio: 'Professora da escola dominical infantil'
      }
    }),
    prisma.user.create({
      data: {
        email: 'carlos@email.com',
        name: 'Carlos Ferreira',
        ministry: 'Diaconia',
        role: 'MEMBER',
        phone: '(11) 99999-0006',
        bio: 'Di√°cono respons√°vel pela assist√™ncia social'
      }
    })
  ])

  // Create forums
  const forums = await Promise.all([
    prisma.forum.create({
      data: {
        name: 'Estudos B√≠blicos',
        description: 'Discuss√µes sobre passagens b√≠blicas e estudos teol√≥gicos',
        icon: 'üìñ'
      }
    }),
    prisma.forum.create({
      data: {
        name: 'D√∫vidas sobre F√©',
        description: 'Espa√ßo para esclarecimentos e crescimento espiritual',
        icon: '‚ùì'
      }
    }),
    prisma.forum.create({
      data: {
        name: 'Testemunhos',
        description: 'Compartilhe seus testemunhos e experi√™ncias com Deus',
        icon: '‚ú®'
      }
    }),
    prisma.forum.create({
      data: {
        name: 'Vida Crist√£',
        description: 'Discuss√µes sobre o dia a dia da vida crist√£',
        icon: 'üôè'
      }
    })
  ])

  // Create groups
  const groups = await Promise.all([
    prisma.group.create({
      data: {
        name: 'Jovens Unidos',
        description: 'Grupo para jovens de 18 a 30 anos, focado em crescimento espiritual e comunh√£o',
        ownerId: members[1].id, // Pedro
        maxMembers: 50
      }
    }),
    prisma.group.create({
      data: {
        name: 'M√£es em Ora√ß√£o',
        description: 'Grupo de m√£es que se re√∫nem para orar pelos filhos e pela fam√≠lia',
        ownerId: members[2].id, // Ana
        maxMembers: 30
      }
    }),
    prisma.group.create({
      data: {
        name: 'Casais na F√©',
        description: 'Grupo para casais crist√£os focado no fortalecimento do matrim√¥nio',
        ownerId: pastor.id,
        maxMembers: 20
      }
    }),
    prisma.group.create({
      data: {
        name: 'Intercessores',
        description: 'Grupo dedicado √† intercess√£o e ora√ß√£o pela igreja e comunidade',
        ownerId: members[0].id, // Maria
        maxMembers: 25
      }
    })
  ])

  // Add group members
  await Promise.all([
    // Jovens Unidos
    prisma.groupMember.create({
      data: {
        userId: members[1].id, // Pedro (owner)
        groupId: groups[0].id,
        role: 'ADMIN'
      }
    }),
    prisma.groupMember.create({
      data: {
        userId: members[2].id, // Ana
        groupId: groups[0].id,
        role: 'MEMBER'
      }
    }),
    // M√£es em Ora√ß√£o
    prisma.groupMember.create({
      data: {
        userId: members[2].id, // Ana (owner)
        groupId: groups[1].id,
        role: 'ADMIN'
      }
    }),
    prisma.groupMember.create({
      data: {
        userId: members[0].id, // Maria
        groupId: groups[1].id,
        role: 'MEMBER'
      }
    })
  ])

  // Create prayer requests
  const prayerRequests = await Promise.all([
    prisma.prayerRequest.create({
      data: {
        title: 'Ora√ß√£o pela minha fam√≠lia',
        content: 'Pe√ßo ora√ß√µes para que minha fam√≠lia encontre paz e uni√£o neste momento dif√≠cil. Estamos passando por algumas dificuldades financeiras e precisamos da dire√ß√£o de Deus.',
        category: 'FAMILY',
        userId: members[0].id, // Maria
        isUrgent: false
      }
    }),
    prisma.prayerRequest.create({
      data: {
        title: 'Recupera√ß√£o de cirurgia',
        content: 'Meu pai passou por uma cirurgia card√≠aca ontem e estamos orando por uma recupera√ß√£o r√°pida e completa. Ele tem 68 anos e precisa muito das ora√ß√µes da igreja.',
        category: 'HEALTH',
        userId: members[1].id, // Pedro
        isUrgent: true
      }
    }),
    prisma.prayerRequest.create({
      data: {
        title: 'Oportunidade de emprego',
        content: 'Estou desempregado h√° 3 meses e preciso de ora√ß√£o para encontrar uma nova oportunidade de trabalho. Tenho fam√≠lia para sustentar e confio na provis√£o de Deus.',
        category: 'WORK',
        userId: members[3].id, // Carlos
        isUrgent: false
      }
    }),
    prisma.prayerRequest.create({
      data: {
        title: 'Crescimento espiritual',
        content: 'Pe√ßo ora√ß√µes para que eu possa crescer mais em minha vida com Deus, ter mais disciplina na leitura b√≠blica e na ora√ß√£o di√°ria.',
        category: 'SPIRITUAL',
        userId: members[2].id, // Ana
        isUrgent: false
      }
    })
  ])

  // Create prayer responses
  await Promise.all([
    prisma.prayerResponse.create({
      data: {
        type: 'PRAYING',
        comment: 'Orando por sua fam√≠lia! Deus tem o controle de todas as coisas.',
        userId: pastor.id,
        prayerRequestId: prayerRequests[0].id
      }
    }),
    prisma.prayerResponse.create({
      data: {
        type: 'PRAYING',
        comment: 'Estou orando pela recupera√ß√£o do seu pai. Deus √© fiel!',
        userId: members[0].id, // Maria
        prayerRequestId: prayerRequests[1].id
      }
    }),
    prisma.prayerResponse.create({
      data: {
        type: 'HEART',
        userId: members[2].id, // Ana
        prayerRequestId: prayerRequests[1].id
      }
    }),
    prisma.prayerResponse.create({
      data: {
        type: 'PRAYING',
        comment: 'Confiando que Deus abrir√° as portas certas para voc√™!',
        userId: members[1].id, // Pedro
        prayerRequestId: prayerRequests[2].id
      }
    })
  ])

  // Create forum posts
  const forumPosts = await Promise.all([
    prisma.forumPost.create({
      data: {
        title: 'Estudo sobre Salmo 23',
        content: 'Gostaria de compartilhar algumas reflex√µes sobre o Salmo 23. Como voc√™s interpretam o vers√≠culo "O Senhor √© o meu pastor, nada me faltar√°"?',
        userId: pastor.id,
        forumId: forums[0].id,
        isPinned: true
      }
    }),
    prisma.forumPost.create({
      data: {
        title: 'Como manter a f√© em tempos dif√≠ceis?',
        content: 'Estou passando por um momento muito dif√≠cil e √†s vezes sinto que minha f√© est√° abalada. Como voc√™s mant√™m a confian√ßa em Deus durante as prova√ß√µes?',
        userId: members[0].id, // Maria
        forumId: forums[1].id
      }
    }),
    prisma.forumPost.create({
      data: {
        title: 'Testemunho de cura',
        content: 'Quero compartilhar o testemunho da cura da minha irm√£. Ela estava com c√¢ncer e hoje os m√©dicos disseram que n√£o h√° mais nenhum sinal da doen√ßa. Deus √© fiel!',
        userId: members[3].id, // Carlos
        forumId: forums[2].id
      }
    })
  ])

  // Create forum comments
  await Promise.all([
    prisma.forumComment.create({
      data: {
        content: 'Excelente reflex√£o, pastor! O Salmo 23 sempre me traz paz e conforto.',
        userId: members[0].id, // Maria
        forumPostId: forumPosts[0].id
      }
    }),
    prisma.forumComment.create({
      data: {
        content: 'Oro para que voc√™ encontre for√ßa na Palavra de Deus. Hebreus 11:1 diz que a f√© √© a certeza de coisas que se esperam.',
        userId: pastor.id,
        forumPostId: forumPosts[1].id
      }
    }),
    prisma.forumComment.create({
      data: {
        content: 'Que testemunho maravilhoso! Gl√≥ria a Deus pela vida da sua irm√£!',
        userId: members[1].id, // Pedro
        forumPostId: forumPosts[2].id
      }
    })
  ])

  // Create notifications
  await Promise.all([
    prisma.notification.create({
      data: {
        title: 'Novo pedido de ora√ß√£o',
        content: 'Maria Santos compartilhou um novo pedido de ora√ß√£o',
        type: 'PRAYER_REQUEST',
        userId: pastor.id
      }
    }),
    prisma.notification.create({
      data: {
        title: 'Coment√°rio no f√≥rum',
        content: 'Voc√™ recebeu um novo coment√°rio no seu post sobre Salmo 23',
        type: 'FORUM_COMMENT',
        userId: pastor.id
      }
    }),
    prisma.notification.create({
      data: {
        title: 'Novo membro no grupo',
        content: 'Ana Costa entrou no grupo Jovens Unidos',
        type: 'GROUP_UPDATE',
        userId: members[1].id // Pedro (owner do grupo)
      }
    })
  ])

  console.log('‚úÖ Database seeded successfully!')
  console.log(`üë• Created ${await prisma.user.count()} users`)
  console.log(`üèõÔ∏è Created ${await prisma.forum.count()} forums`)
  console.log(`üë´ Created ${await prisma.group.count()} groups`)
  console.log(`üôè Created ${await prisma.prayerRequest.count()} prayer requests`)
  console.log(`üí¨ Created ${await prisma.forumPost.count()} forum posts`)
  console.log(`üì± Created ${await prisma.notification.count()} notifications`)
}

main()
  .catch((e) => {
    console.error('‚ùå Error seeding database:', e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })